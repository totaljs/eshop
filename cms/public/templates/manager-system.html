<div class="filter">
	<div class="container">
		<div class="caption" style="margin-bottom:10px"><span class="fa fa-cogs mr5"></span> @(System)</div>
	</div>
</div>
<div class="container">
	<div class="b">@(Backuping)</div>
	<br />
	<table class="table table-bordered">
		<tr>
			<td><span class="fa fa-cloud-download mr5"></span> @(Backup databases + settings)</td>
			<td class="ui-center bg-smoke" style="width:120px"><a href="javascript:void(0)" data-component="click" data-component-path="system_backup_database">@(Backup now)</a></td>
		</tr>
		<tr>
			<td><span class="fa fa-cloud-download mr5"></span> @(Backup full website)</td>
			<td class="ui-center bg-smoke" style="width:120px"><a href="javascript:void(0)" data-component="click" data-component-path="system_backup_website">@(Backup now)</a></td>
		</tr>
	</table>
	<br />
	<div class="b">@(Restoring)</div>
	<br />
	<table class="table table-bordered">
		<tr>
			<td><span class="fa fa-refresh mr5"></span> @(Restore databases + settings)</td>
			<td class="ui-center bg-smoke" style="width:120px"><a href="javascript:void(0)" data-component="click" data-component-path="system_restore_database">@(Restore now)</a></td>
		</tr>
	</table>
	<br />
	<div class="b">@(Clearing)</div>
	<br />
	<table class="table table-bordered">
		<tr>
			<td><span class="fa w18 fa-file-text"></span> @(Clear all pages)</td>
			<td class="ui-center bg-smoke" style="width:120px"><a href="javascript:void(0)" data-component="click" data-component-path="system_clear_pages">@(Clear now)</a></td>
		</tr>
		<tr>
			<td><span class="fa w18 fa-file-text"></span> @(Clear all widgets)</td>
			<td class="ui-center bg-smoke" style="width:120px"><a href="javascript:void(0)" data-component="click" data-component-path="system_clear_widgets">@(Clear now)</a></td>
		</tr>
		<tr>
			<td><span class="fa w18 fa-image"></span> @(Clear all files)</td>
			<td class="ui-center bg-smoke" style="width:120px"><a href="javascript:void(0)" data-component="click" data-component-path="system_clear_files">@(Clear now)</a></td>
		</tr>
		<tr>
			<td><span class="fa w18 fa-envelope"></span> @(Clear newsletter list)</td>
			<td class="ui-center bg-smoke" style="width:120px"><a href="javascript:void(0)" data-component="click" data-component-path="system_clear_newsletter">@(Clear now)</a></td>
		</tr>
		<tr>
			<td><span class="fa w18 fa-bar-chart"></span> @(Clear visitor stats)</td>
			<td class="ui-center bg-smoke" style="width:120px"><a href="javascript:void(0)" data-component="click" data-component-path="system_clear_webcounter">@(Clear now)</a></td>
		</tr>
	</table>
	<br />
	<br />
</div>

<script>
// Backup databases
function system_backup_database() {
	loading(true);
	window.location.href = managerurl + '/api/backup/database/';
	setTimeout(function() {
		loading(false);
	}, 5000);
}

// Restore databases
function system_restore_database() {
	$('#system_restore_backup').click();
}

// Backup website
function system_backup_website() {
	loading(true);
	window.location.href = managerurl + '/api/backup/website/';
	setTimeout(function() {
		loading(false);
	}, 5000);
}

function system_clear_pages() {
	FIND('confirm').confirm('@(Please, confirm clearing of the database.)', ['Clear', 'Cancel'], function(index) {
		if (index)
			return;
		FIND('loading').show();
		AJAX('GET {0}/api/pages/clear/'.format(managerurl), function() {
			success();
			if (window.pages_refresh)
				window.pages_refresh(true);
		});
	});
}

function system_clear_widgets() {
	FIND('confirm').confirm('@(Please, confirm clearing of the database.)', ['Clear', 'Cancel'], function(index) {
		if (index)
			return;
		FIND('loading').show();
		AJAX('GET {0}/api/widgets/clear/'.format(managerurl), function() {
			success();
			if (window.widgets_refresh)
				window.widgets_refresh();
		});
	});
}

function system_clear_files() {
	FIND('confirm').confirm('@(Please, confirm clearing of the database.)', ['Clear', 'Cancel'], function(index) {
		if (index)
			return;
		FIND('loading').show();
		AJAX('GET {0}/api/files/clear/'.format(managerurl), function() {
			success();
		});
	});
}

function system_clear_newsletter() {
	FIND('confirm').confirm('@(Please, confirm clearing of the database.)', ['Clear', 'Cancel'], function(index) {
		if (index)
			return;
		FIND('loading').show();
		AJAX('GET {0}/api/newsletter/clear/'.format(managerurl), function() {
			success();
			if (window.newsletter_refresh)
				window.newsletter_refresh(true);
		});
	});
}

function system_clear_webcounter() {
	FIND('confirm').confirm('@(Please, confirm clearing of the database.)', ['Clear', 'Cancel'], function(index) {
		if (index)
			return;
		FIND('loading').show();
		AJAX('{0}/api/dashboard/clear/'.format(managerurl), function() {
			success();
			setTimeout(function() {
				window.location.reload(true);
			}, 1500);
		});
	});
}

$('#system_restore_backup').on('change', function(e) {
	e.preventDefault();
	e.stopPropagation();
	FIND('loading').show();
	var el = this;
	var data = new FormData();
	data.append('file', this.files[0]);
	UPLOAD(managerurl + '/api/restore/database/', data, function(response, err) {
		el.value = '';
		success(true);
		setTimeout(function() {
			window.location.reload(true);
		}, 1500);
	});
});
</script>